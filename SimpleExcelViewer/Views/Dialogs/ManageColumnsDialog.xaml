<UserControl
	x:Class="SimpleExcelViewer.Views.Dialogs.ManageColumnsDialog"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:base="RW.Base.WPF"
	xmlns:c="clr-namespace:SimpleExcelViewer.Controls"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:dd="urn:gong-wpf-dragdrop"
	xmlns:local="clr-namespace:SimpleExcelViewer.Views.Dialogs"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:wpf="RW.Common.WPF"
	d:Background="White"
	d:DataContext="{d:DesignInstance Type=local:ManageColumnsDialogViewModel}"
	Style="{StaticResource DialogStyle}"
	DataContext="{base:DISource Type=local:ManageColumnsDialogViewModel}"
	Padding="4,4,4,0"
	mc:Ignorable="d">

	<UserControl.Resources>
		<wpf:BindingProxy x:Key="ViewModel" Data="{Binding}"/>

		<wpf:CommandProxy x:Key="RowButtonCommand" Command="{Binding RowButtonCommand}"/>
	</UserControl.Resources>

	<Grid Width="400" Height="400">
		<Border BorderThickness="1" BorderBrush="#d0d0d0">
			<DockPanel>

				<Border
					Padding="4"
					BorderThickness="0,0,0,1"
					BorderBrush="#d0d0d0"
					DockPanel.Dock="Top">
					<wpf:SpacingStackPanel HorizontalSpacing="4" Orientation="Horizontal">
						<Button Command="{Binding ResetOrderCommand}" Content="Reset Order"/>
						<Button Command="{Binding ResetTogglesCommand}" Content="Reset Toggles"/>
						<Button Command="{Binding ToggleAllCommand}" Content="Toggle All"/>
					</wpf:SpacingStackPanel>
				</Border>

				<ScrollViewer Padding="6">
					<ItemsControl
						dd:DragDrop.DropTargetScrollViewer="{Binding RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
						dd:DragDrop.IsDragSource="True"
						dd:DragDrop.IsDropTarget="True"
						IsTabStop="False"
						ItemsSource="{Binding Columns}">

						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<!--<wpf:SpacingStackPanel Orientation="Vertical" VerticalSpacing="4"/>-->
								<VirtualizingStackPanel/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>

						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Background="Transparent">

									<Button x:Name="RowButton"
										Margin="0,0,0,4"
										Padding="0"
										HorizontalContentAlignment="Stretch"
										BorderThickness="1"
										BorderBrush="#d0d0d0"
										Background="Transparent"
										Command="{StaticResource RowButtonCommand}"
										CommandParameter="{Binding}">

										<DockPanel>

											<Border x:Name="LeftBorder"
												Width="30"
												Height="20"
												VerticalAlignment="Stretch"
												Background="#d0d0d0"
												SnapsToDevicePixels="True"
												UseLayoutRounding="True"
												Visibility="Visible">
												<TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
													<TextBlock.Text>
														<MultiBinding Converter="{StaticResource IListToIndexConverter}">
															<Binding Path="Data.Columns" Source="{StaticResource ViewModel}"/>
															<Binding/>
														</MultiBinding>
													</TextBlock.Text>
												</TextBlock>
											</Border>

											<Border Padding="4,2">
												<c:CustomCheckBox x:Name="RowCheckBox"
													VerticalAlignment="Center"
													Content="{Binding Name}"
													IsChecked="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
													IsTabStop="False"/>
											</Border>
										</DockPanel>

									</Button>
								</Border>

								<DataTemplate.Triggers>
									<Trigger SourceName="RowButton" Property="IsMouseOver" Value="True">
										<Setter TargetName="LeftBorder" Property="Background" Value="#e1e1e1"/>
									</Trigger>
									<Trigger SourceName="RowButton" Property="IsPressed" Value="True">
										<Setter TargetName="LeftBorder" Property="Background" Value="#f2f2f2"/>
									</Trigger>
								</DataTemplate.Triggers>

							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>

			</DockPanel>
		</Border>
	</Grid>

</UserControl>
